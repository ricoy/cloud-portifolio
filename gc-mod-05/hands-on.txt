# **Projeto Hands on - SoluÃ§Ã£o**

### AtenÃ§Ã£o!!!

### Essa documentaÃ§Ã£o Ã© constantemente revisada e atualizada conforme mudanÃ§as que ocorrem a todo momento nos provedores de cloud, que consequentemente afetam nossos hands-ons, e, em muitos casos, apenas alguns comandos sÃ£o necessÃ¡rios atualizaÃ§Ã£o/adiÃ§Ã£o. Sendo assim, Ã© crucial e obrigatÃ³rio, durante a implementaÃ§Ã£o dos projetos, o acompanhamento com a â€˜DocumentaÃ§Ã£o de SoluÃ§Ã£oâ€™ que contÃ©m os passos e os comandos necessÃ¡rios, e atualizados!

Parte 01: **CriaÃ§Ã£o e ConfiguraÃ§Ã£o da AplicaÃ§Ã£o em Oregon (USA).**

Parte 02: **MigraÃ§Ã£o das VMs com Storage Snapshot de Oregon (USA) para Sydney (AUS).**

### CriaÃ§Ã£o de um Projeto (Opcional)

- Nome: `tcb-mod5`

### HabilitaÃ§Ã£o das APIs

- APIs & Services | Enable APIs & service
    - **`Compute Engine API`**

# Parte 1 - CriaÃ§Ã£o das VMs em Oregon (USA)

### CriaÃ§Ã£o GCEâ€™s: `Application-01` e `Database-01`

**AplicaÃ§Ã£o**

- Nome: `usa-application-01`
- RegiÃ£o:Â `us-west1 (Oregon)`
- Zone:Â `us-west1-b`
- Tamanho:Â `e2-micro`
- SO:Â `Debian GNU/Linux 12 (bookworm)` x86/64

Create

**Database**

- Nome: `usa-database-01`
- RegiÃ£o:Â `us-west1 (Oregon)`
- Zone:Â `us-west1-b`
- Tamanho:Â `e2-micro`
- SO:Â `Debian GNU/Linux 12 (bookworm)` x86/64

Create

### **GCE - Database: Instalar e Configurar MySQL Server**

### SSH: `usa-database-01`

Theme | Custom | Edit Custom Colors: **Background Color** `#000000`

```yaml
**sudo apt update
sudo apt install wget -y
wget https://repo.mysql.com//mysql-apt-config_0.8.29-1_all.deb
ls
sudo dpkg -i mysql-apt-config_0.8.29-1_all.deb

Select OK**

# Installing MySQL Server
**sudo apt update
sudo apt install mysql-server -y
password: welcome1

Select Use Legacy Authentication Method (Retain MySQL 5.x Compatibility)**

# Restarting MySQL Service
**sudo systemctl restart mysql.service**

# Setting up the MySQL
**sudo mysql_secure_installation
welcome1

"ENTER" para todas as perguntas!**

# Downloading SQL File (Database and Tables)
**wget https://storage.googleapis.com/bootcamp-gcp-en/bootcamp-gcp-storage-db-en.sql
ls
mysql -u root -p**
**welcome1**

# Creating the 'db' and 'tables':
**source bootcamp-gcp-storage-db-en.sql**

show databases;
show tables;

# Creating an user called 'app' and changing the privileges:
**CREATE USER app@'%' IDENTIFIED BY 'welcome1';
GRANT ALL PRIVILEGES ON clinic.* TO app@'%';
FLUSH PRIVILEGES;
exit**

```

Podemos encerrar a conexÃ£o SSH com a instÃ¢ncia `usa-database-01`.

### **GCE - Application: Configurar e Executar a AplicaÃ§Ã£o**

### SSH: `usa-application-01`

Theme | Custom | Edit Custom Colors: **Background Color** `#191970`

```yaml
**sudo apt update
sudo apt install npm -y

sudo apt install zip wget -y
wget https://tcb-bootcamps.s3.amazonaws.com/bootcamp-gcp/mod5/bootcamp-gcp-storage-clinic-mib-app.zip
ls
unzip bootcamp-gcp-storage-clinic-mib-app.zip
cd bootcamp-gcp-storage-clinic-mib-app**
```

AtenÃ§Ã£o:

Todos os comandos serÃ£o executados a partir da pasta:

`bootcamp-gcp-storage-clinic-mib-app`

**Atualizar o arquivoÂ `index.js` com as informaÃ§Ãµes do banco de dados:**

```yaml
**nano src/index.js**
```

SeÃ§Ã£oÂ //**Middlewares**

- **host: â€˜Private IP of your usa-database-01â€™**
- **user: â€˜appâ€™**
- **password: â€˜welcome1â€™**
- **database: â€˜clinicâ€™**

Sair e Salvar: **^+x** | **Y** | **Enter**

**InstalaÃ§Ã£o do NPM**

```yaml
**npm install

npm audit fix --force**
```

> *O NPM (Node Package Manager) Ã© um gerenciador de pacotes para a plataforma Node.js. Ele Ã© uma ferramenta que permite instalar, atualizar, remover e gerenciar as dependÃªncias de um projeto Node.js de forma simples e eficiente.*
> 

**Inicializar a aplicaÃ§Ã£o Node.js**

```yaml
**node src/index.js**
```

**Configurar Regra de Firewall para Permitir Acesso Ã  Porta 3000**

- **Name:**Â `allow-app-port-3000`
- **Targets:**Â `All instances in the network`
- **Source IP ranges:**Â `0.0.0.0/0`
- SelectÂ **`TCP`**Â and the portÂ **`3000`**

**Create**

Acesse a aplicaÃ§Ã£o atravÃ©s do IP PÃºblico da VM `usa-application-01` na porta `3000`

Cadastre ao menos um paciente:

```yaml
Cirrus Cloud
Mike Mouse
Doug Dog
```

- Parar as duas instÃ¢ncias criadas: `usa-application-01` e `usa-database-01`

# Parte 2 - MigraÃ§Ã£o das VMs com Storage Snapshot

- Verificar os discos em uso das instÃ¢ncias `usa-application-01` e `usa-database-01`.
- **Fazer Snapshots** dos discos das VMsÂ criadas: `usa-application-01` e `usa-database-01`.

**Cloud Shell**

```yaml
gcloud compute disks snapshot usa-application-01 --snapshot-names \
usa-application-snapshot --zone us-west1-b

gcloud compute disks snapshot usa-database-01 --snapshot-names \
usa-database-snapshot --zone us-west1-b
```

- **Criar Discos** na regiÃ£oÂ **australia-southeast1 (Sidney)**, utilizando como origem os snapshots gerados da regiÃ£oÂ **us-west1 (Oregon)**.

```yaml
**gcloud compute disks create aus-app01 --source-snapshot usa-application-snapshot \
 --zone australia-southeast1-a

gcloud compute disks create aus-db01 --source-snapshot usa-database-snapshot \
 --zone australia-southeast1-a**
```

- **Criar as instÃ¢ncias na regiÃ£o da AustrÃ¡lia, utilizando como origem os discos criados no passo anterior.**

```yaml
**gcloud compute instances create aus-app01 --machine-type e2-micro --zone \
australia-southeast1-a --disk name=aus-app01,boot=yes,mode=rw

gcloud compute instances create aus-db01 --machine-type e2-micro --zone \
australia-southeast1-a --disk name=aus-db01,boot=yes,mode=rw**
```

### SSH: `aus-app01`

Acessar e Configurar a vm **`aus-app01`**Â com os dados do servidor de BD `aus-db01` 

```yaml
**cd bootcamp-gcp-storage-clinic-mib-app/
nano src/index.js**

host: 'Private IP of your aus-db01 instance'

Save and Exit: **^+x** | **Y** | **Enter

# Installing NPM
npm install**

**# Running the Application
node src/index.js**
```

Testar acesso Ã  AplicaÃ§Ã£o atravÃ©s do IP PÃºblico da VM `aus-app01` na porta `3000`

Os cadastros realizados na aplicaÃ§Ã£o antes da migraÃ§Ã£o, serÃ£o apresentados:

```yaml
Mike Mouse
Cirrus Cloud
Doug Dog
```

# EvidÃªncias

- Print com as 04 VMs criadas
- Print da AplicaÃ§Ã£o Acessada com IP da VM da Australia

![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/0d1b678b-cd91-4256-93c7-73b2e82396d5/ed576016-edfe-455e-83b0-921ff1d94aaf/Untitled.png)

![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/0d1b678b-cd91-4256-93c7-73b2e82396d5/e731e22f-54a5-494f-93c3-a1cc986ef8d0/Untitled.png)

### ExclusÃ£o dos Recursos

- Excluir InstÃ¢ncias;
- Excluir Snapshots;
- Excluir Discos.

***TCB*** ðŸš€